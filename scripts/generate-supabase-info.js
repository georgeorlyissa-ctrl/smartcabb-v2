#!/usr/bin/env node

/**
 * üîß G√âN√âRATION AUTOMATIQUE DU FICHIER info.tsx
 * 
 * Ce script g√©n√®re /utils/supabase/info.tsx depuis les variables d'environnement
 * Il s'ex√©cute AVANT le build Vite pour garantir la disponibilit√© des cl√©s
 */

const fs = require('fs');
const path = require('path');

// R√©cup√©rer les variables d'environnement
const projectId = process.env.VITE_SUPABASE_PROJECT_ID || process.env.SUPABASE_PROJECT_ID;
const publicAnonKey = process.env.VITE_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;

// Validation
if (!projectId) {
  console.error('‚ùå ERREUR: VITE_SUPABASE_PROJECT_ID ou SUPABASE_PROJECT_ID manquant !');
  process.exit(1);
}

if (!publicAnonKey) {
  console.error('‚ùå ERREUR: VITE_SUPABASE_ANON_KEY ou SUPABASE_ANON_KEY manquant !');
  process.exit(1);
}

// Cr√©er le r√©pertoire si n√©cessaire
const dir = path.join(__dirname, '..', 'utils', 'supabase');
if (!fs.existsSync(dir)) {
  fs.mkdirSync(dir, { recursive: true });
}

// G√©n√©rer le contenu du fichier
const content = `/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "${projectId}"
export const publicAnonKey = "${publicAnonKey}"
`;

// √âcrire le fichier
const filePath = path.join(dir, 'info.tsx');
fs.writeFileSync(filePath, content, 'utf-8');

console.log('‚úÖ Fichier /utils/supabase/info.tsx g√©n√©r√© avec succ√®s !');
console.log(`   Project ID: ${projectId}`);
console.log(`   Anon Key: ${publicAnonKey.substring(0, 20)}...`);
