#!/usr/bin/env node

/**
 * üîß G√âN√âRATION AUTOMATIQUE DU FICHIER info.tsx
 * 
 * Ce script g√©n√®re /utils/supabase/info.tsx depuis les variables d'environnement
 * Il s'ex√©cute AVANT le build Vite pour garantir la disponibilit√© des cl√©s
 * 
 * IMPORTANT: Extension .cjs car le projet utilise "type": "module"
 */

const fs = require('fs');
const path = require('path');

console.log('üîß G√©n√©ration du fichier info.tsx...');

// R√©cup√©rer les variables d'environnement
const projectId = process.env.VITE_SUPABASE_PROJECT_ID || process.env.SUPABASE_PROJECT_ID;
const publicAnonKey = process.env.VITE_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;

console.log('üìã Variables d\'environnement d√©tect√©es:');
console.log('   VITE_SUPABASE_PROJECT_ID:', process.env.VITE_SUPABASE_PROJECT_ID ? '‚úÖ' : '‚ùå');
console.log('   SUPABASE_PROJECT_ID:', process.env.SUPABASE_PROJECT_ID ? '‚úÖ' : '‚ùå');
console.log('   VITE_SUPABASE_ANON_KEY:', process.env.VITE_SUPABASE_ANON_KEY ? '‚úÖ' : '‚ùå');
console.log('   SUPABASE_ANON_KEY:', process.env.SUPABASE_ANON_KEY ? '‚úÖ' : '‚ùå');

// Validation
if (!projectId) {
  console.error('');
  console.error('‚ùå ERREUR CRITIQUE: Project ID manquant !');
  console.error('');
  console.error('   Veuillez d√©finir une de ces variables d\'environnement:');
  console.error('   - VITE_SUPABASE_PROJECT_ID');
  console.error('   - SUPABASE_PROJECT_ID');
  console.error('');
  console.error('   Valeur attendue: zaerjqchzqmcxqblkfkg');
  console.error('');
  process.exit(1);
}

if (!publicAnonKey) {
  console.error('');
  console.error('‚ùå ERREUR CRITIQUE: Anon Key manquante !');
  console.error('');
  console.error('   Veuillez d√©finir une de ces variables d\'environnement:');
  console.error('   - VITE_SUPABASE_ANON_KEY');
  console.error('   - SUPABASE_ANON_KEY');
  console.error('');
  process.exit(1);
}

// Cr√©er le r√©pertoire si n√©cessaire
const dir = path.join(__dirname, '..', 'utils', 'supabase');
if (!fs.existsSync(dir)) {
  console.log('üìÅ Cr√©ation du r√©pertoire utils/supabase...');
  fs.mkdirSync(dir, { recursive: true });
}

// G√©n√©rer le contenu du fichier
// G√©n√©rer le contenu du fichier
// G√©n√©rer le contenu du fichier
// G√©n√©rer le contenu du fichier
const content = `/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "${projectId}"
export const publicAnonKey = "${publicAnonKey}"
`;

// √âcrire le fichier
const filePath = path.join(dir, 'info.tsx');
fs.writeFileSync(filePath, content, 'utf-8');

console.log('');
console.log('‚úÖ Fichier /utils/supabase/info.tsx g√©n√©r√© avec succ√®s !');
console.log('   Project ID:', projectId);
console.log('   Anon Key:', publicAnonKey.substring(0, 30) + '...');
console.log('');
