<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîä Test Notification Sonore v2 - SmartCabb</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }

    h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      color: #666;
      text-align: center;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 2px solid #e9ecef;
    }

    .test-section h2 {
      color: #495057;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    button {
      width: 100%;
      padding: 15px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    button.success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .log {
      background: #2d3748;
      color: #a0aec0;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .log div {
      margin-bottom: 5px;
      padding: 3px 0;
    }

    .log .success {
      color: #48bb78;
    }

    .log .error {
      color: #f56565;
    }

    .log .info {
      color: #4299e1;
    }

    .status {
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
      text-align: center;
    }

    .status.success {
      background: #c6f6d5;
      color: #22543d;
      border: 1px solid #9ae6b4;
    }

    .status.error {
      background: #fed7d7;
      color: #742a2a;
      border: 1px solid #fc8181;
    }

    .status.info {
      background: #bee3f8;
      color: #2c5282;
      border: 1px solid #90cdf4;
    }

    .checklist {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    .checklist h3 {
      color: #2d3748;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .checklist ul {
      list-style: none;
      padding-left: 0;
    }

    .checklist li {
      padding: 8px 0;
      color: #4a5568;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .checklist li::before {
      content: "‚úì";
      color: #48bb78;
      font-weight: bold;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîä Test Notification Sonore v2</h1>
    <p class="subtitle">SmartCabb - Syst√®me de Notification Am√©lior√©</p>

    <!-- Test 1 : Beep Simple -->
    <div class="test-section">
      <h2>üéµ Test 1 : Beep Sonore (3x r√©p√©titions)</h2>
      <button onclick="testBeep()">‚ñ∂Ô∏è Tester le Beep</button>
      <div id="beep-status"></div>
    </div>

    <!-- Test 2 : Notification Compl√®te -->
    <div class="test-section">
      <h2>üì¢ Test 2 : Notification Compl√®te (Beep + Vocal)</h2>
      <button class="secondary" onclick="testFullNotification()">‚ñ∂Ô∏è Tester Notification Compl√®te</button>
      <div id="full-status"></div>
    </div>

    <!-- Test 3 : Permissions -->
    <div class="test-section">
      <h2>üîî Test 3 : Permissions Navigateur</h2>
      <button class="success" onclick="checkPermissions()">üîç V√©rifier les Permissions</button>
      <div id="permissions-status"></div>
    </div>

    <!-- Console de logs -->
    <div class="test-section">
      <h2>üìã Console de Logs</h2>
      <div id="log" class="log"></div>
      <button style="margin-top: 10px; background: #718096;" onclick="clearLogs()">üóëÔ∏è Effacer les Logs</button>
    </div>

    <!-- Checklist -->
    <div class="checklist">
      <h3>‚úÖ Checklist de Diagnostic</h3>
      <ul>
        <li>Le volume de votre appareil est au maximum</li>
        <li>Les permissions de notification sont accord√©es</li>
        <li>Le navigateur n'est pas en mode silencieux</li>
        <li>Vous avez cliqu√© sur un bouton (interaction requise)</li>
      </ul>
    </div>
  </div>

  <script>
    // Fonction de log am√©lior√©e
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString('fr-FR');
      const logEntry = document.createElement('div');
      logEntry.className = type;
      logEntry.textContent = `[${timestamp}] ${message}`;
      logDiv.appendChild(logEntry);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[${type.toUpperCase()}]`, message);
    }

    function clearLogs() {
      document.getElementById('log').innerHTML = '';
      log('Logs effac√©s', 'info');
    }

    function showStatus(elementId, message, type = 'info') {
      const statusDiv = document.getElementById(elementId);
      statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    // Test 1 : Beep simple r√©p√©t√© 3 fois
    function testBeep() {
      log('üéµ D√©marrage test beep...', 'info');
      showStatus('beep-status', '‚è≥ Lecture du beep en cours...', 'info');

      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Fonction pour jouer un beep
        function playBeep(delay = 0) {
          setTimeout(() => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // Configuration du beep
            oscillator.frequency.value = 1000; // 1000 Hz
            oscillator.type = 'sine';

            // Volume fort
            gainNode.gain.setValueAtTime(0.8, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.8);

            log(`üîä Beep ${delay / 800 + 1}/3 jou√© √† 1000Hz, volume 0.8`, 'success');
          }, delay);
        }

        // Jouer 3 beeps
        playBeep(0);
        playBeep(800);
        playBeep(1600);

        setTimeout(() => {
          showStatus('beep-status', '‚úÖ Beep termin√© ! Vous avez entendu le son ?', 'success');
          log('‚úÖ Test beep termin√©', 'success');
        }, 2500);

      } catch (error) {
        log(`‚ùå Erreur: ${error.message}`, 'error');
        showStatus('beep-status', `‚ùå Erreur: ${error.message}`, 'error');
      }
    }

    // Test 2 : Notification compl√®te avec vocal
    async function testFullNotification() {
      log('üì¢ D√©marrage notification compl√®te...', 'info');
      showStatus('full-status', '‚è≥ Notification en cours...', 'info');

      try {
        // 1. Beeps r√©p√©t√©s
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playBeep(delay = 0) {
          setTimeout(() => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = 1000;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.8, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.8);
          }, delay);
        }

        playBeep(0);
        playBeep(800);
        playBeep(1600);
        log('üîä 3 beeps jou√©s', 'success');

        // 2. Vibration
        if ('vibrate' in navigator) {
          navigator.vibrate([300, 100, 300, 100, 300]);
          log('üì≥ Vibration activ√©e', 'success');
        } else {
          log('‚ö†Ô∏è Vibration non support√©e', 'info');
        }

        // 3. Message vocal
        await new Promise(resolve => setTimeout(resolve, 2000)); // Attendre fin des beeps

        if ('speechSynthesis' in window) {
          window.speechSynthesis.cancel();
          
          const message = 'Bonjour, vous avez une nouvelle course SmartCabb. D√©part : Avenue Kasavubu, Kinshasa. Destination : Place Lumumba, Kinshasa. Merci de confirmer rapidement.';
          const utterance = new SpeechSynthesisUtterance(message);
          utterance.lang = 'fr-FR';
          utterance.rate = 1.0;
          utterance.pitch = 1.0;
          utterance.volume = 1.0;

          utterance.onstart = () => {
            log('üó£Ô∏è Message vocal d√©marr√©', 'success');
          };

          utterance.onend = () => {
            log('‚úÖ Message vocal termin√©', 'success');
            showStatus('full-status', '‚úÖ Notification compl√®te termin√©e !', 'success');
          };

          utterance.onerror = (event) => {
            log(`‚ùå Erreur vocal: ${event.error}`, 'error');
            showStatus('full-status', `‚ö†Ô∏è Beep OK, mais erreur vocal: ${event.error}`, 'info');
          };

          window.speechSynthesis.speak(utterance);
          log('üó£Ô∏è Synth√®se vocale lanc√©e', 'info');
        } else {
          log('‚ö†Ô∏è Synth√®se vocale non support√©e', 'info');
          showStatus('full-status', '‚úÖ Beep OK, mais synth√®se vocale non support√©e', 'info');
        }

      } catch (error) {
        log(`‚ùå Erreur: ${error.message}`, 'error');
        showStatus('full-status', `‚ùå Erreur: ${error.message}`, 'error');
      }
    }

    // Test 3 : V√©rifier les permissions
    async function checkPermissions() {
      log('üîç V√©rification des permissions...', 'info');
      
      let statusHTML = '<div style="text-align: left; padding: 10px;">';
      
      // 1. Notifications
      if ('Notification' in window) {
        const permission = Notification.permission;
        if (permission === 'granted') {
          statusHTML += '‚úÖ <b>Notifications:</b> Autoris√©es<br>';
          log('‚úÖ Notifications autoris√©es', 'success');
        } else if (permission === 'denied') {
          statusHTML += '‚ùå <b>Notifications:</b> Refus√©es<br>';
          log('‚ùå Notifications refus√©es', 'error');
        } else {
          statusHTML += '‚ö†Ô∏è <b>Notifications:</b> Non demand√©es<br>';
          log('‚ö†Ô∏è Permission notification non demand√©e', 'info');
          
          // Demander la permission
          const result = await Notification.requestPermission();
          if (result === 'granted') {
            statusHTML += '‚úÖ Permission accord√©e maintenant !<br>';
            log('‚úÖ Permission accord√©e', 'success');
          }
        }
      } else {
        statusHTML += '‚ùå <b>Notifications:</b> Non support√©es<br>';
        log('‚ùå Notifications non support√©es', 'error');
      }

      // 2. Audio Context
      if (window.AudioContext || window.webkitAudioContext) {
        statusHTML += '‚úÖ <b>AudioContext:</b> Support√©<br>';
        log('‚úÖ AudioContext support√©', 'success');
      } else {
        statusHTML += '‚ùå <b>AudioContext:</b> Non support√©<br>';
        log('‚ùå AudioContext non support√©', 'error');
      }

      // 3. Speech Synthesis
      if ('speechSynthesis' in window) {
        statusHTML += '‚úÖ <b>Synth√®se Vocale:</b> Support√©e<br>';
        log('‚úÖ Synth√®se vocale support√©e', 'success');
      } else {
        statusHTML += '‚ùå <b>Synth√®se Vocale:</b> Non support√©e<br>';
        log('‚ùå Synth√®se vocale non support√©e', 'error');
      }

      // 4. Vibration
      if ('vibrate' in navigator) {
        statusHTML += '‚úÖ <b>Vibration:</b> Support√©e<br>';
        log('‚úÖ Vibration support√©e', 'success');
      } else {
        statusHTML += '‚ö†Ô∏è <b>Vibration:</b> Non support√©e (normal sur desktop)<br>';
        log('‚ö†Ô∏è Vibration non support√©e', 'info');
      }

      statusHTML += '</div>';
      
      document.getElementById('permissions-status').innerHTML = statusHTML;
      log('üîç V√©rification termin√©e', 'success');
    }

    // Log initial
    log('üöÄ Page de test charg√©e', 'success');
    log('üëÜ Cliquez sur un bouton pour tester', 'info');
  </script>
</body>
</html>
